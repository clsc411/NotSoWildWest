services:
  nodejs:
    build: .                       # Build the node.js app from the current directory
    container_name: wildwest-node  # name the container for node.js
    restart: always
    environment:
      - PORT=3000
      - DB_PATH=/app/data/forum.db
    volumes:
      - ./data:/app/data           # Persist database
    expose:
      - "3000"                    # Expose port 3000 to other containers (not to host)

  nginx:
    build: ./nginx                # build the nginx image from the ./nginx directory
    container_name: wildwest-nginx # Name the container for nginx
    restart: always
    expose:
      - "80"                      # Expose port 80 to other containers (NPM will proxy to this)
    depends_on:
      - nodejs                    # start nginx after Node.js

  npm:
    image: 'jc21/nginx-proxy-manager:latest'
    container_name: wildwest-npm
    restart: unless-stopped
    ports:
      - '80:80'                   # Public HTTP Port
      - '81:81'                   # Admin Web Port
      - '443:443'                 # Public HTTPS Port
    volumes:
      - ./npm-data:/data
      - ./npm-letsencrypt:/etc/letsencrypt
    depends_on:
      - nginx                     # Ensure app is up before proxy

